{{!-- Invoice Matching Report Template --}}

{{#if summary}}
<div class="summary">
  <h2>Executive Summary</h2>
  <div class="summary-grid">
    <div class="summary-item">
      <div class="label">Total Invoices</div>
      <div class="value">{{formatNumber summary.totalInvoices}}</div>
    </div>
    <div class="summary-item">
      <div class="label">Matched</div>
      <div class="value" style="color: #28a745;">{{formatNumber summary.matchedCount}}</div>
    </div>
    <div class="summary-item">
      <div class="label">Unmatched</div>
      <div class="value" style="color: #dc3545;">{{formatNumber summary.unmatchedCount}}</div>
    </div>
    <div class="summary-item">
      <div class="label">Match Rate</div>
      <div class="value">{{formatPercent summary.matchRate}}</div>
    </div>
    <div class="summary-item">
      <div class="label">Total Value</div>
      <div class="value">{{formatCurrency summary.totalValue}}</div>
    </div>
    <div class="summary-item">
      <div class="label">Discrepancy Amount</div>
      <div class="value" style="color: #dc3545;">{{formatCurrency summary.discrepancyAmount}}</div>
    </div>
  </div>
</div>
{{/if}}

<h2>Invoice Matching Results</h2>
{{#if data}}
<table>
  <thead>
    <tr>
      <th>Invoice #</th>
      <th>Vendor</th>
      <th>PO Number</th>
      <th>Invoice Amount</th>
      <th>PO Amount</th>
      <th>Variance</th>
      <th>Status</th>
      <th>Action Required</th>
    </tr>
  </thead>
  <tbody>
    {{#each data}}
    <tr>
      <td><strong>{{this.invoiceNumber}}</strong></td>
      <td>
        <div>{{this.vendorName}}</div>
        <div style="color: #666; font-size: 9pt;">{{this.vendorId}}</div>
      </td>
      <td>{{this.poNumber}}</td>
      <td style="text-align: right;">{{formatCurrency this.invoiceAmount}}</td>
      <td style="text-align: right;">{{formatCurrency this.poAmount}}</td>
      <td style="text-align: right; {{#if this.hasVariance}}color: #dc3545; font-weight: bold;{{/if}}">
        {{#if this.variance}}
          {{formatCurrency this.variance}}
          <div style="font-size: 9pt;">({{formatPercent this.variancePercent}})</div>
        {{else}}
          -
        {{/if}}
      </td>
      <td>
        {{#if (eq this.matchStatus "MATCHED")}}
          <span class="badge badge-success">MATCHED</span>
        {{else if (eq this.matchStatus "PARTIAL")}}
          <span class="badge badge-warning">PARTIAL</span>
        {{else if (eq this.matchStatus "NO_MATCH")}}
          <span class="badge badge-danger">NO MATCH</span>
        {{else}}
          <span class="badge" style="background: #95e1d3; color: #333;">PENDING</span>
        {{/if}}
      </td>
      <td style="font-size: 9pt;">
        {{#if this.actionRequired}}
          <strong style="color: #dc3545;">{{this.actionRequired}}</strong>
        {{else}}
          None
        {{/if}}
      </td>
    </tr>
    {{/each}}
  </tbody>
</table>
{{else}}
<p style="text-align: center; color: #666; padding: 40px 0;">No invoices to display.</p>
{{/if}}

{{#if metadata.unmatchedReasons}}
<div class="page-break"></div>
<h2>Unmatched Invoice Analysis</h2>
<table style="margin-top: 20px;">
  <thead>
    <tr>
      <th>Reason</th>
      <th style="text-align: right;">Count</th>
      <th style="text-align: right;">Percentage</th>
    </tr>
  </thead>
  <tbody>
    {{#each metadata.unmatchedReasons}}
    <tr>
      <td>{{this.reason}}</td>
      <td style="text-align: right;">{{formatNumber this.count}}</td>
      <td style="text-align: right;">{{formatPercent this.percentage}}</td>
    </tr>
    {{/each}}
  </tbody>
</table>
{{/if}}

{{#if metadata.recommendations}}
<div style="margin-top: 30px; background: #f5f5f5; padding: 15px; border-left: 4px solid #0066cc;">
  <h3>Recommendations</h3>
  <ul style="margin-left: 20px;">
    {{#each metadata.recommendations}}
    <li style="margin-bottom: 10px;">{{this}}</li>
    {{/each}}
  </ul>
</div>
{{/if}}
